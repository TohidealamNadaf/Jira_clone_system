<!DOCTYPE html>
<html>
<head>
    <title>Velocity Chart Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>Velocity Chart Debug</h2>
    
    <div class="alert alert-danger">
        <h4>Is the page loading at all?</h4>
        <p>Check the response status and console</p>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h5>Test 1: Direct Access</h5>
            <p>Go to: <code>/jira_clone_system/public/reports/velocity/1</code></p>
            <p>Expected: See velocity chart page</p>
            <p id="test1">Testing...</p>
        </div>

        <div class="col-md-6">
            <h5>Test 2: Check Data</h5>
            <p>Go to: <code>/jira_clone_system/test_velocity_raw.php</code></p>
            <p>Expected: See JSON with velocity data</p>
            <p id="test2">Testing...</p>
        </div>
    </div>

    <hr>

    <h5>Test 3: Fetch Velocity Page</h5>
    <pre id="response"></pre>

    <hr>

    <h5>Console Output</h5>
    <button class="btn btn-primary" onclick="testAccess()">Run Tests</button>
    <pre id="console"></pre>
</div>

<script>
const log = document.getElementById('console');

function testAccess() {
    log.innerHTML = '';
    log.textContent += 'Testing velocity endpoint...\n';

    fetch('/jira_clone_system/public/reports/velocity/1', {
        method: 'GET',
        headers: {
            'Accept': 'text/html',
            'Cookie': document.cookie
        }
    })
    .then(response => {
        log.textContent += `Status: ${response.status}\n`;
        log.textContent += `Content-Type: ${response.headers.get('content-type')}\n`;
        return response.text();
    })
    .then(html => {
        log.textContent += `Response length: ${html.length}\n`;
        
        // Check for key elements
        if (html.includes('velocityChart')) {
            log.textContent += '✅ Canvas element found\n';
        } else {
            log.textContent += '❌ Canvas element NOT found\n';
        }
        
        if (html.includes('VELOCITY SCRIPT LOADED')) {
            log.textContent += '✅ Script section found\n';
        } else {
            log.textContent += '❌ Script section NOT found\n';
        }
        
        if (html.includes('rawVelocityData')) {
            log.textContent += '✅ JavaScript variable found\n';
        } else {
            log.textContent += '❌ JavaScript variable NOT found\n';
        }

        // Show first 500 chars
        log.textContent += '\n--- First 500 chars ---\n';
        log.textContent += html.substring(0, 500);
    })
    .catch(error => {
        log.textContent += `ERROR: ${error.message}\n`;
    });
}

// Auto-run when page loads
window.addEventListener('load', testAccess);
</script>
</body>
</html>
