<!DOCTYPE html>
<html>
<head>
    <title>Chart.js Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        canvas { max-width: 600px; margin: 20px 0; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Chart.js Test Page</h1>
    
    <div class="log" id="output"></div>
    
    <div style="position: relative; height: 400px; width: 600px;">
        <canvas id="testChart"></canvas>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : '';
            div.textContent = msg;
            output.appendChild(div);
            console.log(msg);
        }
        
        log('✅ Page loaded');
        
        // Check if Chart.js loaded
        if (typeof Chart === 'undefined') {
            log('❌ Chart.js not loaded!', true);
        } else {
            log('✅ Chart.js loaded: ' + Chart.version);
        }
        
        // Test data
        const testData = [
            {sprint_name: "Sprint 1", committed: 21, completed: 21, start_date: "2025-01-01", end_date: "2025-01-14"},
            {sprint_name: "Sprint 2", committed: 34, completed: 34, start_date: "2025-01-15", end_date: "2025-01-28"},
            {sprint_name: "Sprint 3", committed: 14, completed: 14, start_date: "2025-01-29", end_date: "2025-02-11"}
        ];
        
        log('Test data: ' + JSON.stringify(testData));
        
        // Create chart
        try {
            const canvas = document.getElementById('testChart');
            if (!canvas) {
                log('❌ Canvas not found!', true);
            } else {
                log('✅ Canvas found');
                
                const labels = testData.map(d => d.sprint_name);
                const committed = testData.map(d => d.committed);
                const completed = testData.map(d => d.completed);
                const avg = (completed.reduce((a,b) => a+b, 0) / completed.length).toFixed(1);
                
                const ctx = canvas.getContext('2d');
                log('✅ Canvas context 2d created');
                
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Committed',
                                data: committed,
                                backgroundColor: 'rgba(108, 117, 125, 0.6)',
                                borderColor: '#6c757d',
                                borderWidth: 1
                            },
                            {
                                label: 'Completed',
                                data: completed,
                                backgroundColor: 'rgba(25, 135, 84, 0.8)',
                                borderColor: '#198754',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
                
                log('✅ Chart created successfully!');
            }
        } catch (error) {
            log('❌ Error creating chart: ' + error.message, true);
            log('Stack: ' + error.stack, true);
        }
    </script>
</body>
</html>
